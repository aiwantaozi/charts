apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    graph: nginx-connection
  name: ingresscontroller-nginx-connection-reading
  namespace: {{ .Values.namespace }}
spec:
  expression: nginx_connections{state="reading"}
  step: 10
  description: ingresscontroller nginx connection reading
  legendFormat: "Reading connections"
  detailsLegendFormat: "Reading connections"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    graph: nginx-connection
  name: ingresscontroller-nginx-connection-waiting
  namespace: {{ .Values.namespace }}
spec:
  expression: nginx_connections{state="waiting"}
  step: 10
  description: ingresscontroller nginx connection waiting
  legendFormat: "Nginx waiting connection"
  detailsLegendFormat: "Nginx waiting connection"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    graph: nginx-connection
  name: ingresscontroller-nginx-connection-writing
  namespace: {{ .Values.namespace }}
spec:
  expression: nginx_connections{state="writing"}
  step: 10
  description: ingresscontroller nginx connection writing
  legendFormat: "Writing connections"
  detailsLegendFormat: "Writing connections"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    graph: nginx-connection
  name: ingresscontroller-nginx-connection-accepted
  namespace: {{ .Values.namespace }}
spec:
  expression: nginx_connections{state="accepted"}
  step: 10
  description: ingresscontroller nginx connection accepted
  legendFormat: "Accepted connections"
  detailsLegendFormat: "Accepted connections"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    graph: nginx-connection
  name: ingresscontroller-nginx-connection-active
  namespace: {{ .Values.namespace }}
spec:
  expression: nginx_connections{state="active"}
  step: 10
  description: ingresscontroller nginx connection active
  legendFormat: "Active connections"
  detailsLegendFormat: "Active connections"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    graph: nginx-connection
  name: ingresscontroller-nginx-connection-handled
  namespace: {{ .Values.namespace }}
spec:
  expression: nginx_connections{state="handled"}
  step: 10
  description: ingresscontroller nginx connection handled
  legendFormat: "Handled connections"
  detailsLegendFormat: "Handled connections"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    metric: upstream-response-seconds
  name: ingresscontroller-upstream-response-seconds-by-host
  namespace: {{ .Values.namespace }}
spec:
  expression: sort_desc(max(upstream_response_time_seconds_sum) by (host, path))
  step: 10
  description: ingresscontroller nginx upstream response seconds by host
  legendFormat: "Upstream response seconds"
  detailsLegendFormat: "Upstream response seconds"
---
apiVersion: cluster.cattle.io/v3
kind: MonitorMetric
metadata:
  labels:
    app: {{ template "app.name" . }}
    chart: {{ template "app.version" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
    source: rancher-monitoring
    level: cluster
    component: ingresscontroller
    metric: request-process-seconds
  name: ingresscontroller-nginx-process-seconds-by-path
  namespace: {{ .Values.namespace }}
spec:
  expression: max(request_duration_seconds_bucket{le="1"}) by ($groupBy)
  step: 10
  description: ingresscontroller nginx request duration by path
  groupBy: host, path
  legendFormat: "Request duration([[host]]:[[path]])"
  detailsLegendFormat: "Request duration([[host]]:[[path]])"

  